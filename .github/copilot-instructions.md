# 共通ルール

1. ドキュメントは日本語で記載する
1. ソースコード上のコメント・XMLコメントは開発者向けのため日本語で記載し、ソースコードやログ出力は英語で記載する
1. 原則として処理失敗時のフォールバックは行わず、処理が失敗したことを示すエラー・例外を返す実装とすること。
1. 全ての例外は、トレースログへException.ToString()の内容を出力すること。そのため、例外を再throwせずに捨てる場合は、その場でトレースログを出力すること。
1. C#のテストコードはNUnitとMoqを使用し、AssertはAssert.Thatの方式を使用する。

# Spec-Kit Governance (Repository-wide)

spec-kitの開発プロセスを使用すること。

## フェーズと目的

1. **Specify**  
   - “何を作るか” と “なぜそれを作るか” を明確に記述する段階です。  
   - ユーザー体験、成果 (outcomes)、受け入れ条件、エッジケース、非機能要件などを含みます。  
   - 技術選定・アーキテクチャの細かい話はここでは主目的ではありません。

2. **Plan**  
   - Specify を受けて、“どう実装するか” の技術的設計を行います。  
   - 使用する技術スタック、アーキテクチャ、制約事項、パフォーマンス・セキュリティ要件など。  
   - 必要なら複数案を比較し、最善のものを選ぶ。

3. **Tasks**  
   - Plan を基に実際の作業タスクに分解します。  
   - 各タスクはレビューとテストが可能な小さい単位で、できるだけ一人で完結できる形にする。  
   - タスク間の依存関係を整理し、実行順を明らかにする。

## チェックポイント（次フェーズへのゲート）

- Specify → Plan に進む前に：仕様が十分に明文化されており、曖昧さや漏れがないか確認する。受け入れ条件・非機能要件・エッジケースが含まれているか。  
- Plan → Tasks に進む前に：技術的制約やアーキテクチャが合意済みで、実装可能性が評価されているか。リスクが見えているか。  
- Tasks → 実装に進む前に：タスクの粒度が十分に小さいか、レビューやテストが可能か、依存関係が明らかか確認する。  

## タスク粒度の基準（目安）

- 各タスクは数時間〜数日で終わるもの。  
- 単一の目的を持ち、他のタスクとあまり依存しないもの。  
- 成果物が検証可能であること（例：ユニットテスト・動作確認など）。  

## プロジェクト憲章（Constitution）の参照

プロジェクトの “憲章”（constitution.md）に記載された基準：

- コーディング標準、テスト戦略、可用性・セキュリティ要件、スタイルガイドなどを尊重すること。  
- 仕様・設計・タスク分解の全フェーズで、これらの基準に従って判断を行うこと。

## 順序

フェーズは **Specify → Plan → Tasks → Implement** の順で進めます。  
前のフェーズの成果物がレビュー／承認されてから次に移ること。

## ドキュメント管理ルール

[ドキュメント管理ルール](instructions/documentation-guidelines.instructions.md) に従うこと。

## 補足

- フェーズ間で新たな気づきがあれば、Spec を修正してフィードバックループを回してください。  
- タスクの粒度や非機能要件の深さなどはこのプロジェクトの規模・リスク・チーム構成によって調整可能ですが、上記基準を下回らないようにしてください。


# ツール

## ビルド

ビルドには `msbuild` を PowerShell から実行すること。`dotnet build` は使用しない。

MSBuild のパスは `vswhere.exe` で取得し、変数 `$msbuild` に格納してから実行すること。
コマンドの形は次のパターンに揃える：

```powershell
$msbuild = & "${env:ProgramFiles(x86)}\Microsoft Visual Studio\Installer\vswhere.exe" `
    -latest -products * -requires Microsoft.Component.MSBuild `
    -find "MSBuild\**\Bin\MSBuild.exe"

& $msbuild "<.sln / .csproj などのフルパス>" /m /p:Configuration=Debug
```

※msbuildのオプションは最低限の例示であり、必要に応じて追加・変更してもよい。

注意:初回のみ.libの参照エラーでビルドが失敗する場合があるので、.libの参照エラーが発生した場合は念のためもう一度同じコマンドでビルドを試みること。
